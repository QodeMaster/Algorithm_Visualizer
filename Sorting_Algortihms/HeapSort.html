<!DOCTYPE html>
<html>
    <head>
        <title>Merge Sort</title>
        <meta charset="UTF-8">
    </head>
    
    <body>
        <canvas id="can0" style="border: 2px solid black;" width="1080" height="520"></canvas>
        <button onclick="turnOnOff()" style="display: block; border: 2px solid black; background-color: white; padding: 1em; font-size: 1em; cursor: pointer; margin-top: 1em;">Start & Stop</button>
        <button onclick="rateShift()" style="display: block; border: 2px solid black; background-color: white; padding: 1em; font-size: 1em; cursor: pointer; margin-top: 1em;">Toggle Speed</button>
        <button onclick="location.reload();" style="border: 2px solid black; background-color: white; padding: 1em; font-size: 1em; cursor: pointer; margin-top: 1em;">Reset</button>
        
        <script>
            const c0 = document.getElementById("can0");
            const ctx = c0.getContext("2d");
            const width = c0.width;
            const height = c0.height;
            let stapleArr = [];
            let onOff = false;
            let indexLogger = 0;
            let frameSaveArray = [];
            let frameSpeed = 300;
            
            let randNum = () => ~~(Math.random() * 400) + 20;

            function frameFiller(arr) {
                let frame = [];
                for(let i = 0; i < arr.length; i++) frame.push([arr[i], "#0000ff"]);
                return frame;
            }
            
            for(let i = 0; i <= 30; i++) {
                let stapleHeight = randNum();
                stapleArr.push(stapleHeight);
            }
            frameSaveArray.push(frameFiller(stapleArr));
            draw(frameSaveArray[0]);

            function sort(arr) {
                let n = arr.length;

                // Build max heap
                for (let i = n / 2 - 1; i >= 0; i--) {
                  heapify(arr, n, i);
                }

                // Heap sort
                for (let i = n - 1; i >= 0; i--) {
                  let temp = arr[0];
                  arr[0] = arr[i];
                  arr[i] = temp;

                  // Heapify root element
                  heapify(arr, i, 0);
                }
              }

              function heapify(arr, n, i) {
                // Find largest among root, left child and right child
                let largest = i;
                let l = 2 * i + 1;
                let r = 2 * i + 2;

                if (l < n && arr[l] > arr[largest])
                  largest = l;

                if (r < n && arr[r] > arr[largest])
                  largest = r;

                // Swap and continue heapifying if root is not largest
                if (largest != i) {
                  //int swap = arr[i];
                  //arr[i] = arr[largest];
                  //arr[largest] = swap;
                  [arr[i], arr[largest]] = [arr[largest], arr[i]];

                  heapify(arr, n, largest);
                }
              }

              // Driver code
              let arr = [ 1, 12, 9, 5, 6, 10 ];

              console.log(arr);
              sort(arr);
              console.log(arr);

            function turnOnOff() {
                onOff = !onOff;
                function forLoop(i) {
                    draw(frameSaveArray[i]);
                    indexLogger = i;
                    if(i < frameSaveArray.length - 1 && onOff) setTimeout(forLoop, frameSpeed, i + 1);
                    else if(frameSaveArray.length - 1 <= i) lastDraw(stapleArr);
                }
                setTimeout(forLoop, frameSpeed, indexLogger);
            }


            
            function rateShift() {
                if(frameSpeed == 300) frameSpeed = 100;
                else frameSpeed = 300;
            }
            
            function draw(arr) {
                ctx.clearRect(0, 0, width, height);
                let elem;
                for(let i = 0; i < width - 160; i += 30) {
                    elem = arr[i / 30];
                    ctx.fillStyle = elem[1];
                    ctx.fillRect(i + 80, height - elem[0], 20, elem[0]);
                }
            }

            function lastDraw(arr) {
                ctx.fillStyle = "#00cc00";
                function forLoop(i) {
                    ctx.fillRect(i + 80, height - arr[i / 30], 20, arr[i / 30]);
                    if(i < width - 160) setTimeout(forLoop, frameSpeed, i + 30);
                }
                setTimeout(forLoop, frameSpeed, 0);
            }
            
        </script>
    </body>
</html>
